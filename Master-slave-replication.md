# redis 主从复制 读写分离

## 什么是redis的主从复制

+ 主从复制
    
    + 概念： 单机版redis只有一个redis节点，负责读写操作， 通过扩充redis服务节点，形成
    主从架构， 主节点负责写操作， 从节点负责读操作， 并且从节点像主节点复制同步数据
    
+ 主从复制的优缺点

   + 优点： 利用主从复制，将读操作和写操作进行分离，分担了主节点的访问压力，将
           读操作走从节点，主节点进行写操作;
           当并发量高的时候，通过扩充从节点，扮演只读操作 可以方便的扩展
           主节点宕机，可以将从节点升级为主节点
           
   + 缺点: 会有数据冗余，因为从节点需要定时向主节点进行同步，所以假设主节点有10t 数据，那么从节点
          也会有10t 数据，并且从节点使用的是全量拷贝，去进行同步，意味着主节点有多少数据
          从节点也会有多少数据，当 数据量大的时候，会有存储压力
          因为主从是一主多从，主节点还是单机，会产生单点故障，并且没有释放写压力
          
          
+ 主从复制的原理
   
   <127.0.0.1:6379> info replication
   <Replication
   ##### 角色
   role:master
   ##### 从节点的连接数
   connected_slaves:2
   # 从节点详细信息 IP PORT 状态 命令(单位:字节长度)偏移量 延迟秒数
   # 主节点每次处理完写操作，会把命令的字节长度累加到master_repl_offset中。
   # 从节点在接收到主节点发送的命令后，会累加记录子什么偏移量信息slave_repl_offset，同时，也会每秒钟上报自身的复制偏移量到主节点，以供主节点记录存储。
   # 在实际应用中，可以通过对比主从复制偏移量信息来监控主从复制健康状况。
   slave0:ip=192.168.10.102,port=6379,state=online,offset=23866,lag=0
   slave1:ip=192.168.10.103,port=6379,state=online,offset=23866,lag=0
   # master启动时生成的40位16进制的随机字符串，用来标识master节点
   master_replid:acc2aaa1f0bb0fd79d7d3302f16bddcbe4add423
   master_replid2:0000000000000000000000000000000000000000
   # master 命令(单位:字节长度)已写入的偏移量
   master_repl_offset:23866
   second_repl_offset:-1
   # 0/1：关闭/开启复制积压缓冲区标志(2.8+)，主要用于增量复制及丢失命令补救
   repl_backlog_active:1
   # 缓冲区最大长度，默认 1M
   repl_backlog_size:1048576
   # 缓冲区起始偏移量
   repl_backlog_first_byte_offset:1
   # 缓冲区已存储的数据长度
   repl_backlog_histlen:23866
        